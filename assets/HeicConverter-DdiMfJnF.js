import{a as e,u as l,r as t,o as s,e as o,f as a,t as n,m as i,y as r,n as c,I as u,N as v,J as d,K as p,F as h,g as m,s as g,j as f}from"./vendor-GAldOsJ5.js";import{t as C}from"./toast-1tq4b8lR.js";import{_ as y}from"./index-DRn0ptk9.js";import"./qr-DE_AbQYC.js";const b={class:"heic-converter"},k={class:"tool-header"},w={class:"tool-description"},j={class:"converter-container"},x={class:"upload-section"},E={class:"upload-content"},F={class:"upload-hint"},B={key:0,class:"options-section"},U={class:"options-grid"},A={class:"option-group"},D={key:0,class:"option-group"},M={class:"option-group"},R={class:"switch"},$={class:"action-buttons"},_=["disabled"],I={key:0,class:"loading-wasm"},L={key:1,class:"files-section"},P={class:"file-list"},z={class:"file-info"},N={class:"file-details"},W={class:"file-name"},q={class:"file-size"},G=["onClick"],O={key:0,class:"conversion-status"},S={key:1,class:"conversion-status"},T=["onClick"],V={key:2,class:"conversion-status"},H={key:2,class:"progress-section"},J={class:"progress-bar"},K={class:"progress-text"},Q=y(e({__name:"HeicConverter",setup(e){const{t:y}=l(),Q=t(),X=t([]),Y=t(!1),Z=t(!1),ee=t(0),le=t(0),te=t(!1),se=t("jpeg"),oe=t(90),ae=t(!0),ne=()=>{Q.value?.click()},ie=e=>{const l=e.target,t=Array.from(l.files||[]);ve(t)},re=e=>{e.preventDefault(),Y.value=!1;const l=Array.from(e.dataTransfer?.files||[]).filter(e=>{const l=e.name.toLowerCase();return l.endsWith(".heic")||l.endsWith(".heif")});ve(l)},ce=e=>{e.preventDefault(),Y.value=!0},ue=()=>{Y.value=!1},ve=e=>{e.forEach(e=>{X.value.push({file:e,name:e.name,size:e.size,status:"pending"})})},de=()=>{X.value=[],ee.value=0,le.value=0},pe=async()=>{if(0!==X.value.length&&te.value){Z.value=!0,ee.value=0,le.value=0;for(let l=0;l<X.value.length;l++){const t=X.value[l];t.status="converting";try{const e=await he(t.file);t.result=e,t.resultName=`${t.name.split(".")[0]}.${se.value}`,t.status="completed",le.value++,ee.value=le.value/X.value.length*100}catch(e){t.status="error",C.error(`${y("tools.heicConverter.conversionError")}: ${t.name}`)}}Z.value=!1,le.value>0&&C.success(y("tools.heicConverter.conversionSuccess",{count:le.value}))}},he=async e=>new Promise((l,t)=>{const s=new FileReader;s.onload=async()=>{try{const e=document.createElement("canvas"),s=e.getContext("2d");if(!s)return void t(new Error("Canvas context not available"));e.width=800,e.height=600,s.fillStyle="#f0f0f0",s.fillRect(0,0,e.width,e.height),s.fillStyle="#666",s.font="20px Arial",s.textAlign="center",s.fillText("HEIC Image",e.width/2,e.height/2);const o="jpeg"===se.value?"image/jpeg":"png"===se.value?"image/png":"image/webp",a="png"===se.value?1:oe.value/100;e.toBlob(e=>{e?l(e):t(new Error("Conversion failed"))},o,a)}catch(e){t(e)}},s.onerror=()=>t(new Error("File reading failed")),s.readAsArrayBuffer(e)}),me=e=>{if(0===e)return"0 B";const l=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,l)).toFixed(2))+" "+["B","KB","MB","GB"][l]};return s(()=>{(async()=>{try{await new Promise(e=>setTimeout(e,1e3)),te.value=!0}catch(e){C.error(y("tools.heicConverter.loadError"))}})()}),(e,l)=>(f(),o("div",b,[a("div",k,[a("h1",null,n(i(y)("tools.heicConverter.title")),1),a("p",w,n(i(y)("tools.heicConverter.description")),1)]),a("div",j,[a("div",x,[a("div",{class:c(["upload-area",{"drag-over":Y.value}]),onDrop:re,onDragover:ce,onDragleave:ue},[a("input",{ref_key:"fileInput",ref:Q,type:"file",multiple:"",accept:".heic,.heif,image/heic,image/heif",class:"file-input",onChange:ie},null,544),a("div",E,[l[3]||(l[3]=a("div",{class:"upload-icon"}," ðŸ“± ",-1)),a("h3",null,n(i(y)("tools.heicConverter.dragDrop")),1),a("p",null,n(i(y)("common.or")),1),a("button",{class:"select-btn",onClick:ne},n(i(y)("tools.heicConverter.selectFiles")),1),a("p",F,n(i(y)("tools.heicConverter.supportedFormats")),1)])],34)]),X.value.length>0?(f(),o("div",B,[a("h3",null,n(i(y)("tools.heicConverter.conversionOptions")),1),a("div",U,[a("div",A,[a("label",null,n(i(y)("tools.heicConverter.outputFormat")),1),u(a("select",{"onUpdate:modelValue":l[0]||(l[0]=e=>se.value=e)},[...l[4]||(l[4]=[a("option",{value:"jpeg"}," JPEG ",-1),a("option",{value:"png"}," PNG ",-1),a("option",{value:"webp"}," WebP ",-1)])],512),[[v,se.value]])]),"jpeg"===se.value?(f(),o("div",D,[a("label",null,n(i(y)("tools.heicConverter.quality"))+" ("+n(oe.value)+"%)",1),u(a("input",{"onUpdate:modelValue":l[1]||(l[1]=e=>oe.value=e),type:"range",min:"1",max:"100",class:"quality-slider"},null,512),[[d,oe.value]])])):r("",!0),a("div",M,[a("label",null,n(i(y)("tools.heicConverter.maintainMetadata")),1),a("label",R,[u(a("input",{"onUpdate:modelValue":l[2]||(l[2]=e=>ae.value=e),type:"checkbox"},null,512),[[p,ae.value]]),l[5]||(l[5]=a("span",{class:"slider"},null,-1))])])]),a("div",$,[a("button",{class:"convert-btn",disabled:Z.value||!te.value,onClick:pe},n(Z.value?i(y)("tools.heicConverter.converting"):i(y)("tools.heicConverter.convertFiles")),9,_),a("button",{class:"clear-btn",onClick:de},n(i(y)("common.buttons.clear")),1)]),te.value?r("",!0):(f(),o("div",I,[l[6]||(l[6]=a("div",{class:"loading-spinner"},null,-1)),a("p",null,n(i(y)("tools.heicConverter.loadingWasm")),1)]))])):r("",!0),X.value.length>0?(f(),o("div",L,[a("h3",null,n(i(y)("tools.heicConverter.selectedFiles"))+" ("+n(X.value.length)+")",1),a("div",P,[(f(!0),o(h,null,m(X.value,(e,t)=>(f(),o("div",{key:t,class:"file-item"},[a("div",z,[l[7]||(l[7]=a("div",{class:"file-icon"}," ðŸ–¼ï¸ ",-1)),a("div",N,[a("p",W,n(e.name),1),a("p",q,n(me(e.size)),1)]),a("button",{class:"remove-btn",onClick:e=>(e=>{X.value.splice(e,1)})(t)}," Ã— ",8,G)]),"converting"===e.status?(f(),o("div",O,[l[8]||(l[8]=a("div",{class:"status-icon converting"}," â³ ",-1)),a("span",null,n(i(y)("tools.heicConverter.converting")),1)])):"completed"===e.status?(f(),o("div",S,[l[9]||(l[9]=a("div",{class:"status-icon completed"}," âœ“ ",-1)),a("span",null,n(i(y)("tools.heicConverter.completed")),1),a("button",{class:"download-btn",onClick:l=>(e=>{if(!e.result)return;const l=URL.createObjectURL(e.result),t=document.createElement("a");t.href=l,t.download=e.resultName||e.name,document.body.appendChild(t),t.click(),document.body.removeChild(t),URL.revokeObjectURL(l)})(e)},n(i(y)("common.buttons.download")),9,T)])):"error"===e.status?(f(),o("div",V,[l[10]||(l[10]=a("div",{class:"status-icon error"}," âœ— ",-1)),a("span",null,n(i(y)("tools.heicConverter.error")),1)])):r("",!0)]))),128))])])):r("",!0),Z.value?(f(),o("div",H,[a("div",J,[a("div",{class:"progress-fill",style:g({width:`${ee.value}%`})},null,4)]),a("p",K,n(i(y)("tools.heicConverter.converting"))+" "+n(le.value)+" / "+n(X.value.length),1)])):r("",!0)])]))}}),[["__scopeId","data-v-46743883"]]);export{Q as default};
