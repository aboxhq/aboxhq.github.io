import{a,u as e,r as t,o as n,b as l,e as s,f as o,t as r,y as c,n as i,q as v,k as u,M as d,F as h,g as m,j as p}from"./vendor-GAldOsJ5.js";import{e as y,j as g}from"./qr-DE_AbQYC.js";import{_ as b}from"./index-DcaCmn-e.js";const w={class:"qr-scanner"},k={class:"tool-header"},f={class:"tool-title"},C={class:"tool-description"},S={class:"tool-content"},x={class:"scanner-layout"},$={class:"scanner-section"},q={class:"scanner-tabs"},D={key:0,class:"camera-scanner"},I={key:0,class:"camera-start-overlay"},M={class:"camera-start"},E=["disabled"],U={key:0},R={key:1},_={class:"camera-note"},B={key:0,class:"camera-error"},W={class:"error-message"},z={key:1,class:"camera-overlay"},A={key:2,class:"camera-controls"},H={key:1,class:"file-scanner"},T={class:"upload-content"},j={key:0,class:"uploaded-image"},N=["src"],O={class:"results-section"},F={class:"results-header"},L={key:0,class:"result-actions"},J={key:0,class:"scan-result"},P={class:"result-content"},Q={class:"result-text"},V={class:"result-value"},G={class:"result-actions-extended"},K={key:1,class:"scanning-state"},X={key:2,class:"scanning-ready"},Y={class:"scanning-hint"},Z={key:3,class:"no-result"},aa={class:"no-result-hint"},ea={key:4,class:"scan-history"},ta={class:"history-list"},na=["onClick"],la={class:"history-content"},sa={class:"history-text"},oa={class:"history-time"},ra=["onClick"],ca=b(a({__name:"QRScanner",setup(a){const{t:b}=e(),ca=t("camera"),ia=t(!1),va=t(!1),ua=t(!1),da=t(""),ha=t(""),ma=t([]),pa=t(0),ya=t(""),ga=t(),ba=t();let wa=null;const ka=t([]);n(async()=>{try{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Error("getUserMedia is not supported in this browser");if("https:"!==location.protocol&&"localhost"!==location.hostname)throw new Error("Camera access requires HTTPS or localhost");if(va.value=await y.hasCamera(),va.value)try{const a=await navigator.mediaDevices.enumerateDevices();ma.value=a.filter(a=>"videoinput"===a.kind)}catch(e){ma.value=[]}}catch(e){va.value=!1,ya.value=e instanceof Error?e.message:"Unknown error"}const a=localStorage.getItem("qr-scan-history");if(a)try{ka.value=JSON.parse(a)}catch(e){}}),l(()=>{Ca()});const fa=async()=>{if(ga.value)if(va.value)try{ua.value=!0,ya.value="";try{(await navigator.mediaDevices.getUserMedia({video:!0})).getTracks().forEach(a=>a.stop())}catch(a){throw new Error("Camera permission denied. Please allow camera access and try again.")}wa=new y(ga.value,a=>{Da(a)},{highlightScanRegion:!0,highlightCodeOutline:!0,returnDetailedScanResult:!1,maxScansPerSecond:10,preferredCamera:"environment"}),await wa.start(),ia.value=!0,ua.value=!1}catch(e){if(ya.value=e instanceof Error?e.message:"Failed to start camera",ua.value=!1,ia.value=!1,wa){try{wa.destroy()}catch(t){}wa=null}}else ya.value="Camera not supported";else ya.value="Video element not found"},Ca=()=>{wa&&(wa.stop(),wa.destroy(),wa=null),ia.value=!1,ua.value=!1},Sa=async()=>{if(wa&&!(ma.value.length<=1))try{pa.value=(pa.value+1)%ma.value.length}catch(a){}},xa=a=>{const e=a.target.files?.[0];e&&qa(e)},$a=a=>{a.preventDefault();const e=a.dataTransfer?.files[0];e&&e.type.startsWith("image/")&&qa(e)},qa=async a=>{ua.value=!0;try{const e=new FileReader;e.onload=a=>{const e=a.target?.result;ha.value=e;const t=document.createElement("canvas"),n=t.getContext("2d"),l=new Image;l.onload=()=>{try{t.width=l.width,t.height=l.height,n?.drawImage(l,0,0);const a=n?.getImageData(0,0,t.width,t.height);if(a){let e=g(a.data,a.width,a.height,{inversionAttempts:"dontInvert"});e||(e=g(a.data,a.width,a.height,{inversionAttempts:"onlyInvert"})),e||(e=g(a.data,a.width,a.height,{inversionAttempts:"attemptBoth"})),e?Da(e.data):da.value=""}else da.value=""}catch(a){da.value=""}finally{ua.value=!1}},l.onerror=()=>{da.value="",ua.value=!1},l.src=e},e.onerror=()=>{da.value="",ua.value=!1},e.readAsDataURL(a)}catch(e){da.value="",ua.value=!1}},Da=a=>{da.value=a,Ia(a),ua.value=!1},Ia=a=>{const e={content:a,timestamp:Date.now()},t=ka.value.findIndex(e=>e.content===a);-1!==t&&ka.value.splice(t,1),ka.value.unshift(e),ka.value.length>10&&(ka.value=ka.value.slice(0,10)),localStorage.setItem("qr-scan-history",JSON.stringify(ka.value))},Ma=()=>{ha.value="",ba.value&&(ba.value.value="")},Ea=async()=>{try{await navigator.clipboard.writeText(da.value)}catch(a){}},Ua=()=>{da.value=""},Ra=a=>{try{return new URL(a),!0}catch{return!1}},_a=a=>a.startsWith("mailto:")||/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a),Ba=a=>a.startsWith("tel:")||/^[\+]?[1-9][\d]{0,15}$/.test(a),Wa=()=>{window.open(da.value,"_blank")},za=()=>{const a=_a(da.value)&&!da.value.startsWith("mailto:")?`mailto:${da.value}`:da.value;window.open(a)},Aa=()=>{const a=Ba(da.value)&&!da.value.startsWith("tel:")?`tel:${da.value}`:da.value;window.open(a)},Ha=()=>{},Ta=()=>{},ja=async()=>{if(wa&&ga.value)try{const a=document.createElement("canvas"),e=a.getContext("2d");if(e&&ga.value.videoWidth&&ga.value.videoHeight){a.width=ga.value.videoWidth,a.height=ga.value.videoHeight,e.drawImage(ga.value,0,0);const t=e.getImageData(0,0,a.width,a.height),n=g(t.data,t.width,t.height);n&&Da(n.data)}}catch(a){}};return(a,e)=>(p(),s("div",w,[o("div",k,[o("h1",f,r(a.$t("tools.qrScanner.title")),1),o("p",C,r(a.$t("tools.qrScanner.description")),1)]),o("div",S,[o("div",x,[o("div",$,[o("div",q,[o("button",{class:i(["tab-button",{active:"camera"===ca.value}]),onClick:e[0]||(e[0]=a=>ca.value="camera")},[e[5]||(e[5]=o("svg",{class:"tab-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[o("path",{d:"M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"}),o("circle",{cx:"12",cy:"13",r:"4"})],-1)),v(" "+r(a.$t("tools.qrScanner.camera")),1)],2),o("button",{class:i(["tab-button",{active:"file"===ca.value}]),onClick:e[1]||(e[1]=a=>ca.value="file")},[e[6]||(e[6]=u('<svg class="tab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" data-v-99cb4d36><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" data-v-99cb4d36></path><polyline points="14,2 14,8 20,8" data-v-99cb4d36></polyline><line x1="16" y1="13" x2="8" y2="13" data-v-99cb4d36></line><line x1="16" y1="17" x2="8" y2="17" data-v-99cb4d36></line><polyline points="10,9 9,9 8,9" data-v-99cb4d36></polyline></svg>',1)),v(" "+r(a.$t("tools.qrScanner.uploadFile")),1)],2)]),"camera"===ca.value?(p(),s("div",D,[o("video",{ref_key:"videoElement",ref:ga,class:"camera-video",autoplay:"",muted:"",playsinline:"",onLoadedmetadata:Ha,onCanplay:Ta},null,544),ia.value?c("",!0):(p(),s("div",I,[o("div",M,[o("button",{class:"btn btn-primary btn-lg",disabled:!va.value||ua.value,onClick:fa},[e[7]||(e[7]=o("svg",{class:"btn-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[o("circle",{cx:"12",cy:"12",r:"3"}),o("path",{d:"M12 1v6m0 6v6m11-7h-6m-6 0H1"})],-1)),ua.value?(p(),s("span",U,r(a.$t("common.messages.loading")),1)):(p(),s("span",R,r(va.value?a.$t("tools.qrScanner.startCamera"):a.$t("tools.qrScanner.cameraNotSupported")),1))],8,E),o("p",_,r(a.$t("tools.qrScanner.allowCameraAccess")),1),ya.value?(p(),s("div",B,[o("p",W,r(ya.value),1)])):c("",!0)])])),ia.value?(p(),s("div",z,[...e[8]||(e[8]=[o("div",{class:"scan-frame"},null,-1)])])):c("",!0),ia.value?(p(),s("div",A,[o("button",{class:"btn btn-secondary",onClick:Ca},r(a.$t("tools.qrScanner.stopCamera")),1),ma.value.length>1?(p(),s("button",{key:0,class:"btn btn-secondary",onClick:Sa},r(a.$t("tools.qrScanner.switchCamera")),1)):c("",!0),o("button",{class:"btn btn-primary btn-sm",onClick:ja},r(a.$t("tools.qrScanner.manualScan")),1)])):c("",!0)])):c("",!0),"file"===ca.value?(p(),s("div",H,[o("div",{class:"file-upload-area",onDrop:$a,onDragover:e[3]||(e[3]=d(()=>{},["prevent"])),onDragenter:e[4]||(e[4]=d(()=>{},["prevent"]))},[o("input",{ref_key:"fileInput",ref:ba,type:"file",accept:"image/*",class:"file-input",onChange:xa},null,544),o("div",T,[e[9]||(e[9]=o("svg",{class:"upload-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[o("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),o("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),o("polyline",{points:"21,15 16,10 5,21"})],-1)),o("h3",null,r(a.$t("common.dragDrop")),1),o("p",null,r(a.$t("common.or")),1),o("button",{class:"btn btn-primary",onClick:e[2]||(e[2]=a=>ba.value?.click())},r(a.$t("common.browse")),1)])],32),ha.value?(p(),s("div",j,[o("img",{src:ha.value,alt:"Uploaded image",class:"preview-image"},null,8,N),o("button",{class:"btn btn-secondary btn-sm",onClick:Ma},r(a.$t("common.buttons.clear")),1)])):c("",!0)])):c("",!0)]),o("div",O,[o("div",F,[o("h2",null,r(a.$t("common.labels.result")),1),da.value?(p(),s("div",L,[o("button",{class:"btn btn-primary btn-sm",onClick:Ea},r(a.$t("common.buttons.copy")),1),o("button",{class:"btn btn-secondary btn-sm",onClick:Ua},r(a.$t("common.buttons.clear")),1)])):c("",!0)]),da.value?(p(),s("div",J,[o("div",P,[o("div",Q,[o("h3",null,r(a.$t("tools.qrScanner.decodedContent"))+":",1),o("div",V,r(da.value),1)]),o("div",G,[Ra(da.value)?(p(),s("button",{key:0,class:"btn btn-primary",onClick:Wa},r(a.$t("tools.qrScanner.openUrl")),1)):c("",!0),_a(da.value)?(p(),s("button",{key:1,class:"btn btn-primary",onClick:za},r(a.$t("tools.qrScanner.sendEmail")),1)):c("",!0),Ba(da.value)?(p(),s("button",{key:2,class:"btn btn-primary",onClick:Aa},r(a.$t("tools.qrScanner.callNumber")),1)):c("",!0)])])])):ua.value?(p(),s("div",K,[e[10]||(e[10]=o("div",{class:"scanning-animation"},[o("div",{class:"scanning-line"})],-1)),o("p",null,r(a.$t("common.processing")),1)])):ia.value?(p(),s("div",X,[e[11]||(e[11]=o("div",{class:"scanning-animation"},[o("div",{class:"scanning-line"})],-1)),o("p",null,r(a.$t("tools.qrScanner.scanningReady")),1),o("p",Y,r(a.$t("tools.qrScanner.pointCameraAtQR")),1)])):(p(),s("div",Z,[e[12]||(e[12]=u('<svg class="no-result-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" data-v-99cb4d36><rect x="3" y="3" width="5" height="5" data-v-99cb4d36></rect><rect x="16" y="3" width="5" height="5" data-v-99cb4d36></rect><rect x="3" y="16" width="5" height="5" data-v-99cb4d36></rect><path d="M13 13h3v3h-3z" data-v-99cb4d36></path><path d="M13 17h3v1h-3z" data-v-99cb4d36></path><path d="M17 13h1v3h-1z" data-v-99cb4d36></path><path d="M21 16h-1v2h1z" data-v-99cb4d36></path></svg>',1)),o("p",null,r(a.$t("tools.qrScanner.noQrDetected")),1),o("p",aa,r(a.$t("tools.qrScanner.useCameraOrUpload")),1)])),ka.value.length>0?(p(),s("div",ea,[o("h3",null,r(a.$t("tools.qrScanner.recentScans")),1),o("div",ta,[(p(!0),s(h,null,m(ka.value,(a,t)=>{return p(),s("div",{key:t,class:"history-item",onClick:e=>(a=>{da.value=a.content})(a)},[o("div",la,[o("span",sa,r((l=a.content,c=50,l.length>c?l.substring(0,c)+"...":l)),1),o("span",oa,r((n=a.timestamp,new Date(n).toLocaleTimeString())),1)]),o("button",{class:"history-remove",onClick:d(a=>(a=>{ka.value.splice(a,1),localStorage.setItem("qr-scan-history",JSON.stringify(ka.value))})(t),["stop"])},[...e[13]||(e[13]=[o("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[o("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),o("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)])],8,ra)],8,na);var n,l,c}),128))])])):c("",!0)])])])]))}}),[["__scopeId","data-v-99cb4d36"]]);export{ca as default};
