import{a as e,u as t,r as o,L as l,o as a,e as s,f as n,t as r,y as i,M as c,n as u,I as v,N as p,J as g,q as d,K as m,j as h}from"./vendor-sPCxxDNi.js";import{t as b}from"./toast-CSo0l4e7.js";import{_ as f}from"./index-BFyA9hmL.js";import"./qr-DE_AbQYC.js";const y={class:"bg-remover"},R={class:"tool-header"},$={class:"bg-remover-container"},w={class:"upload-content"},k={class:"upload-text"},x={class:"upload-hint"},D={class:"processing-options"},I={class:"options-grid"},C={class:"option-group"},U={value:"auto"},S={value:"green"},F={value:"blue"},M={class:"option-group"},_={class:"value"},V={class:"option-group"},j={class:"option-group"},E={key:0,class:"processing-area"},P={class:"image-comparison"},T={class:"image-panel"},q={class:"image-container"},B=["src"],L={class:"image-panel"},A={class:"image-container"},H={key:0,class:"processing-overlay"},N=["src"],O={key:2,class:"placeholder"},W={class:"action-buttons"},G=["disabled"],J={key:0,class:"advanced-controls"},K={class:"controls-grid"},Z={class:"control-group"},z={class:"value"},Q={class:"control-group"},X={class:"value"},Y=f(e({__name:"BgRemover",setup(e){const{t:f}=t(),Y=o(!1),ee=o(!1),te=o(),oe=o(""),le=o(""),ae=o(),se=o(),ne=l({algorithm:"auto",sensitivity:50,outputFormat:"png",edgeSmoothing:!0}),re=l({threshold:128,feather:2});function ie(e){e.preventDefault(),Y.value=!0}function ce(e){e.preventDefault(),Y.value=!1}function ue(e){e.preventDefault(),Y.value=!1;const t=e.dataTransfer?.files[0];t&&t.type.startsWith("image/")&&pe(t)}function ve(e){const t=e.target.files?.[0];t&&pe(t)}function pe(e){const t=new FileReader;t.onload=e=>{oe.value=e.target?.result,le.value=""},t.readAsDataURL(e)}async function ge(){if(oe.value){ee.value=!0;try{const e=new Image;e.onload=()=>{const t=document.createElement("canvas");t.width=e.width,t.height=e.height;const o=t.getContext("2d");o.drawImage(e,0,0);const l=o.getImageData(0,0,e.width,e.height),a=l.data;if("auto"===ne.algorithm)for(let n=0;n<a.length;n+=4){const t=a[n],o=a[n+1],l=a[n+2];!de(a,n,e.width,e.height)&&me(t,o,l)&&(a[n+3]=0)}else if("green"===ne.algorithm)for(let e=0;e<a.length;e+=4){const t=a[e],o=a[e+1],l=a[e+2];o>t+30&&o>l+30&&o>re.threshold&&(a[e+3]=0)}else if("blue"===ne.algorithm)for(let e=0;e<a.length;e+=4){const t=a[e],o=a[e+1],l=a[e+2];l>t+30&&l>o+30&&l>re.threshold&&(a[e+3]=0)}ne.edgeSmoothing&&function(e,t,o){const l=re.feather,a=new Uint8ClampedArray(e);for(let s=0;s<o;s++)for(let n=0;n<t;n++){const r=4*(s*t+n);if(a[r+3]>0&&a[r+3]<255){let i=0,c=0;for(let e=-l;e<=l;e++)for(let r=-l;r<=l;r++){const l=n+r,u=s+e;if(l>=0&&l<t&&u>=0&&u<o){i+=a[4*(u*t+l)+3],c++}}e[r+3]=i/c}}}(a,e.width,e.height),o.putImageData(l,0,0);const s="webp"===ne.outputFormat?"image/webp":"image/png";le.value=t.toDataURL(s),b.success(f("tools.bgRemover.processingSuccess")),ee.value=!1},e.src=oe.value}catch(e){b.error(f("tools.bgRemover.processingError")),ee.value=!1}}}function de(e,t,o,l){const a=t/4%o,s=Math.floor(t/4/o);if(0===a||a===o-1||0===s||s===l-1)return!0;const n=[e[t],e[t+1],e[t+2]],r=[[-1,-1],[0,-1],[1,-1],[-1,0],[1,0],[-1,1],[0,1],[1,1]];for(const[i,c]of r){const t=4*((s+c)*o+(a+i)),l=[e[t],e[t+1],e[t+2]];if(Math.sqrt(Math.pow(n[0]-l[0],2)+Math.pow(n[1]-l[1],2)+Math.pow(n[2]-l[2],2))>2.55*ne.sensitivity)return!0}return!1}function me(e,t,o){return(e+t+o)/3>re.threshold||e>240&&t>240&&o>240}function he(){oe.value&&!ee.value&&ge()}function be(){if(!le.value)return;const e=document.createElement("a");e.download=`bg_removed.${ne.outputFormat}`,e.href=le.value,e.click()}function fe(){oe.value="",le.value="",te.value&&(te.value.value="")}return a(()=>{const e=document.createElement("canvas");ae.value=e,se.value=e.getContext("2d")}),(e,t)=>(h(),s("div",y,[n("div",R,[n("h1",null,r(e.$t("tools.bgRemover.title")),1),n("p",null,r(e.$t("tools.bgRemover.description")),1)]),n("div",$,[n("div",{class:u(["upload-area",{"drag-over":Y.value}]),onDrop:c(ue,["prevent"]),onDragover:c(ie,["prevent"]),onDragleave:c(ce,["prevent"]),onClick:t[0]||(t[0]=e=>te.value?.click())},[n("input",{ref_key:"fileInput",ref:te,type:"file",accept:"image/*",class:"file-input",onChange:ve},null,544),n("div",w,[t[7]||(t[7]=n("svg",{class:"upload-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[n("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),n("polyline",{points:"17 8 12 3 7 8"}),n("line",{x1:"12",y1:"3",x2:"12",y2:"15"})],-1)),n("p",k,r(e.$t("tools.bgRemover.uploadText")),1),n("p",x,r(e.$t("tools.bgRemover.uploadHint")),1)])],34),n("div",D,[n("h3",null,r(e.$t("tools.bgRemover.processingOptions")),1),n("div",I,[n("div",C,[n("label",null,r(e.$t("tools.bgRemover.algorithm")),1),v(n("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>ne.algorithm=e),class:"select"},[n("option",U,r(e.$t("tools.bgRemover.autoDetect")),1),n("option",S,r(e.$t("tools.bgRemover.greenScreen")),1),n("option",F,r(e.$t("tools.bgRemover.blueScreen")),1)],512),[[p,ne.algorithm]])]),n("div",M,[n("label",null,r(e.$t("tools.bgRemover.sensitivity")),1),v(n("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>ne.sensitivity=e),type:"range",min:"1",max:"100",step:"1",class:"slider"},null,512),[[g,ne.sensitivity,void 0,{number:!0}]]),n("span",_,r(ne.sensitivity)+"%",1)]),n("div",V,[n("label",null,r(e.$t("tools.bgRemover.outputFormat")),1),v(n("select",{"onUpdate:modelValue":t[3]||(t[3]=e=>ne.outputFormat=e),class:"select"},t[8]||(t[8]=[n("option",{value:"png"}," PNG (Transparent) ",-1),n("option",{value:"webp"}," WebP (Transparent) ",-1)]),512),[[p,ne.outputFormat]])]),n("div",j,[n("label",null,[v(n("input",{"onUpdate:modelValue":t[4]||(t[4]=e=>ne.edgeSmoothing=e),type:"checkbox",class:"checkbox"},null,512),[[m,ne.edgeSmoothing]]),d(" "+r(e.$t("tools.bgRemover.edgeSmoothing")),1)])])])]),oe.value?(h(),s("div",E,[n("div",P,[n("div",T,[n("h3",null,r(e.$t("tools.bgRemover.originalImage")),1),n("div",q,[n("img",{src:oe.value,alt:"Original",class:"preview-image"},null,8,B)])]),n("div",L,[n("h3",null,r(e.$t("tools.bgRemover.resultImage")),1),n("div",A,[ee.value?(h(),s("div",H,[t[9]||(t[9]=n("div",{class:"spinner"},null,-1)),n("p",null,r(e.$t("tools.bgRemover.processing")),1)])):le.value?(h(),s("img",{key:1,src:le.value,alt:"Processed",class:"preview-image"},null,8,N)):(h(),s("div",O,[n("p",null,r(e.$t("tools.bgRemover.clickProcess")),1)]))])])]),n("div",W,[n("button",{disabled:ee.value,class:"primary-btn",onClick:ge},r(ee.value?e.$t("tools.bgRemover.processing"):e.$t("tools.bgRemover.removeBackground")),9,G),le.value?(h(),s("button",{key:0,class:"secondary-btn",onClick:be},r(e.$t("tools.bgRemover.download")),1)):i("",!0),n("button",{class:"secondary-btn",onClick:fe},r(e.$t("tools.bgRemover.reset")),1)]),le.value?(h(),s("div",J,[n("h3",null,r(e.$t("tools.bgRemover.advancedControls")),1),n("div",K,[n("div",Z,[n("label",null,r(e.$t("tools.bgRemover.threshold")),1),v(n("input",{"onUpdate:modelValue":t[5]||(t[5]=e=>re.threshold=e),type:"range",min:"0",max:"255",step:"1",class:"slider",onInput:he},null,544),[[g,re.threshold,void 0,{number:!0}]]),n("span",z,r(re.threshold),1)]),n("div",Q,[n("label",null,r(e.$t("tools.bgRemover.feather")),1),v(n("input",{"onUpdate:modelValue":t[6]||(t[6]=e=>re.feather=e),type:"range",min:"0",max:"20",step:"1",class:"slider",onInput:he},null,544),[[g,re.feather,void 0,{number:!0}]]),n("span",X,r(re.feather)+"px",1)])])])):i("",!0)])):i("",!0)])]))}}),[["__scopeId","data-v-75b6fac7"]]);export{Y as default};
